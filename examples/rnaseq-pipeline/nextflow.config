/*
 * Configuration for RNA-seq Pipeline Example
 * Demonstrates nf-pregex plugin setup
 */

// Enable nf-pregex plugin
plugins {
    id 'nf-pregex@0.1.0'
}

// Manifest
manifest {
    name = 'nf-pregex-rnaseq-example'
    author = 'nf-pregex contributors'
    description = 'Simple RNA-seq pipeline demonstrating nf-pregex pattern matching benefits'
    mainScript = 'main.nf'
    version = '1.0.0'
    nextflowVersion = '>=23.10.0'
}

// Default parameters
params {
    // Input files
    reads = "data/*_{R1,R2}.fastq.gz"
    reference = "reference/genome.fa"
    
    // Output directory
    outdir = "results"
    
    // Options
    skip_qc = false
    
    // Help message
    help = false
}

// Process configuration
process {
    // Default resources
    cpus = 2
    memory = '4.GB'
    time = '1.h'
    
    // Process-specific settings
    withName: 'FASTQC' {
        cpus = 2
        memory = '2.GB'
    }
    
    withName: 'TRIMMOMATIC' {
        cpus = 4
        memory = '4.GB'
    }
    
    withName: 'STAR_ALIGN' {
        cpus = 8
        memory = '32.GB'
    }
    
    withName: 'FEATURECOUNTS' {
        cpus = 2
        memory = '4.GB'
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = 8
    memory = '16.GB'
}

// Reporting
report {
    enabled = true
    file = "${params.outdir}/pipeline_report.html"
    overwrite = true
}

timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
    overwrite = true
}

// Profiles
profiles {
    standard {
        process.executor = 'local'
    }
    
    docker {
        docker.enabled = true
        process {
            withName: 'FASTQC' {
                container = 'quay.io/biocontainers/fastqc:0.12.1--hdfd78af_0'
            }
            withName: 'TRIMMOMATIC' {
                container = 'quay.io/biocontainers/trimmomatic:0.39--hdfd78af_2'
            }
            withName: 'STAR_ALIGN' {
                container = 'quay.io/biocontainers/star:2.7.11a--h0033a41_0'
            }
            withName: 'FEATURECOUNTS' {
                container = 'quay.io/biocontainers/subread:2.0.6--he4a0461_0'
            }
        }
    }
    
    test {
        params {
            reads = "${projectDir}/test_data/*_{R1,R2}.fastq.gz"
            reference = "${projectDir}/test_data/genome.fa"
            outdir = "test_results"
        }
    }
}
